<!--
	ReguStreaming
	Copyright 2018. ReguMaster all rights reserved.
-->

<!DOCTYPE html>
<html lang="ko">

    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="./style.css">
    </head>

    <body>
        <div class="RS-status">
            <div class="RS-status-icon"></div>
            <p class="RS-status-serverName">ReguStreaming : SERVER</p>
            <p class="RS-status-stats">CPU: 0%, RAM: 0bytes</p>
        </div>
        <div class="RS-logConsole"></div>
        <input type="text" name="commandField" class="RS-commandField" placeholder="> ..." autofocus />

        <script>
        let logCount = 0;

        window.$ = window.jQuery = require( "jquery" );
        window.electron = require( "electron" );

        let controls = {
            logConsole: $( ".RS-logConsole" ),
            statusIcon: $( ".RS-status-icon" ),
            statusStat: $( ".RS-status-stats" )
        };

        window.onbeforeunload = function( e )
        {
            return false;
        }

        window.onload = function( )
        {
            $( ".RS-commandField" ).on( "keypress", function( e )
            {
                if ( e.which === 13 ) // Enter í‚¤
                {
                    var self = $( this );

                    if ( self.val( ).length <= 0 ) return;

                    electron.ipcRenderer.send( "commandExecute",
                    {
                        type: "command",
                        command: self.val( )
                    } );

                    self.val( "" );
                }
            } );
        }

        electron.ipcRenderer.on( "serverStats", function( e, stats )
        {
            controls.statusStat.text( `CPU: ${ stats.cpu }%, RAM: ${ stats.memory }bytes` );
        } );

        electron.ipcRenderer.on( "serverStatus", function( e, code )
        {
            controls.statusIcon.removeClass( "online offline" );
            switch ( code )
            {
                case 0:
                    controls.statusIcon.addClass( "offline" );
                    break;
                case 1:
                    controls.statusIcon.addClass( "online" );
                    break;
            }
        } );

        electron.ipcRenderer.on( "log", function( e, level, message )
        {
            if ( ++logCount > 500 )
            {
                logCount--;
                $( "#logItem:first" ).remove( );
            }

            var isScrollOnBottom = controls.logConsole.scrollTop( ) + controls.logConsole.innerHeight( ) >= controls.logConsole.prop( "scrollHeight" );

            controls.logConsole.append( `<div class="RS-logItem logLevel-${ level }" id="logItem">${ message }</div>` );

            if ( isScrollOnBottom )
                controls.logConsole.scrollTop( controls.logConsole.prop( "scrollHeight" ) );
        } );


        electron.ipcRenderer.on( "clearLog", function( e, stats )
        {
            controls.logConsole.empty( );
            logCount = 0;
        } );
        </script>
    </body>

</html>